{"version":3,"file":"index.cjs","sources":["../src/utils/error.ts","../src/utils/file-name.ts","../src/utils/has-property.ts","../src/utils/object.ts","../src/utils/to-array.ts","../src/locator/utils.ts","../src/locator/async.ts","../src/locator/sync.ts","../src/loader/utils.ts","../src/loader/built-in/module/utils.ts","../src/loader/built-in/module/module.ts","../src/loader/built-in/json/module.ts","../src/loader/constants.ts","../src/loader/module.ts","../src/loader/singleton.ts","../src/loader/helpers.ts"],"sourcesContent":["/*\n * Copyright (c) 2022.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\n/* istanbul ignore next */\nexport function handleFileLoadError(e: unknown) : void {\n    if (e instanceof Error) {\n        throw e;\n    }\n\n    if (typeof e === 'string') {\n        throw new Error(e);\n    }\n\n    throw new Error('Cannot determine file loading error.');\n}\n","/*\n * Copyright (c) 2022.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nexport function removeFileNameExtension(\n    input: string,\n    extensions?: string[],\n) {\n    if (input.includes('.')) {\n        const position = input.lastIndexOf('.');\n        const extension = input.substring(\n            position,\n            input.length,\n        );\n\n        if (\n            typeof extensions === 'undefined' ||\n            extensions.indexOf(extension) !== -1\n        ) {\n            input = input.substring(0, position);\n        }\n    }\n\n    return input;\n}\n","export function hasOwnProperty<X extends Record<string, any>, Y extends PropertyKey>(obj: X, prop: Y): obj is X & Record<Y, unknown> {\n    return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nexport function hasStringProperty<X extends Record<string, any>, Y extends PropertyKey>(obj: X, prop: Y): obj is X & Record<Y, string> {\n    return hasOwnProperty(obj, prop) && typeof obj[prop] === 'string';\n}\n","/*\n * Copyright (c) 2022.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nexport function isObject(item: unknown) : item is Record<string, any> {\n    return (\n        !!item &&\n        typeof item === 'object' &&\n        !Array.isArray(item)\n    );\n}\n","/*\n * Copyright (c) 2022.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nexport function toArray(input: string | string[]) : string[] {\n    return Array.isArray(input) ? input : [input];\n}\n","/*\n * Copyright (c) 2022.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nimport path from 'node:path';\nimport type { LocatorInfo, LocatorOptions } from './type';\nimport { toArray } from '../utils';\n\nexport function buildLocatorOptions(options?: Partial<LocatorOptions>) : LocatorOptions {\n    options = options || {};\n\n    options.path = options.path || [];\n    options.path = toArray(options.path);\n    if (options.path.length === 0) {\n        options.path.push(process.cwd());\n    }\n\n    options.ignore ??= [];\n\n    return options as LocatorOptions;\n}\n\nexport function isFilePath(input: string) {\n    const info = path.parse(input);\n    return info.ext !== '';\n}\n\nexport function pathToLocatorInfo(\n    input: string,\n    skipResolve?: boolean,\n) : LocatorInfo {\n    if (\n        !skipResolve &&\n        !path.isAbsolute(input)\n    ) {\n        input = path.resolve(process.cwd(), input);\n    }\n\n    const info = path.parse(input);\n\n    return {\n        path: info.dir.split('/').join(path.sep),\n        name: info.name,\n        extension: info.ext,\n    };\n}\n","/*\n * Copyright (c) 2022.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nimport glob from 'glob';\nimport { promisify } from 'node:util';\nimport type { LocatorInfo, LocatorOptions } from './type';\nimport { buildLocatorOptions, pathToLocatorInfo } from './utils';\n\nconst globAsync = promisify(glob);\n\nexport async function locateMany(\n    pattern: string | string[],\n    options?: Partial<LocatorOptions>,\n) : Promise<LocatorInfo[]> {\n    options = buildLocatorOptions(options);\n\n    const patterns = Array.isArray(pattern) ?\n        pattern :\n        [pattern];\n\n    const items : LocatorInfo[] = [];\n\n    for (let i = 0; i < patterns.length; i++) {\n        for (let j = 0; j < (options as LocatorOptions).path.length; j++) {\n            const files = await globAsync(patterns[i] as string, {\n                absolute: true,\n                cwd: (options as LocatorOptions).path[j],\n                nodir: true,\n                ignore: options.ignore,\n            });\n\n            for (let k = 0; k < files.length; k++) {\n                items.push(pathToLocatorInfo(files[k] as string, true));\n            }\n        }\n    }\n\n    return items;\n}\n\nexport async function locate(\n    pattern: string | string[],\n    options?: Partial<LocatorOptions>,\n) : Promise<LocatorInfo | undefined> {\n    options = buildLocatorOptions(options);\n\n    const patterns = Array.isArray(pattern) ?\n        pattern :\n        [pattern];\n\n    for (let i = 0; i < patterns.length; i++) {\n        for (let j = 0; j < (options as LocatorOptions).path.length; j++) {\n            const files = await globAsync(patterns[i] as string, {\n                absolute: true,\n                cwd: (options as LocatorOptions).path[j],\n                nodir: true,\n                ignore: options.ignore,\n            });\n\n            const element = files.shift();\n            if (element) {\n                return pathToLocatorInfo(element, true);\n            }\n        }\n    }\n\n    return undefined;\n}\n","/*\n * Copyright (c) 2022.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nimport glob from 'glob';\nimport type { LocatorInfo, LocatorOptions } from './type';\nimport { buildLocatorOptions, pathToLocatorInfo } from './utils';\n\nexport function locateManySync(\n    pattern: string | string[],\n    options?: Partial<LocatorOptions>,\n) : LocatorInfo[] {\n    options = buildLocatorOptions(options);\n\n    const patterns = Array.isArray(pattern) ?\n        pattern :\n        [pattern];\n\n    const items : LocatorInfo[] = [];\n\n    for (let i = 0; i < patterns.length; i++) {\n        for (let j = 0; j < (options as LocatorOptions).path.length; j++) {\n            const files = glob.sync(patterns[i] as string, {\n                absolute: true,\n                cwd: (options as LocatorOptions).path[j],\n                nodir: true,\n                ignore: options.ignore,\n            });\n\n            for (let k = 0; k < files.length; k++) {\n                items.push(pathToLocatorInfo(files[k] as string, true));\n            }\n        }\n    }\n\n    return items;\n}\n\nexport function locateSync(\n    pattern: string | string[],\n    options?: Partial<LocatorOptions>,\n) : LocatorInfo | undefined {\n    options = buildLocatorOptions(options);\n\n    const patterns = Array.isArray(pattern) ?\n        pattern :\n        [pattern];\n\n    for (let i = 0; i < patterns.length; i++) {\n        for (let j = 0; j < (options as LocatorOptions).path.length; j++) {\n            const files = glob.sync(patterns[i] as string, {\n                absolute: true,\n                cwd: (options as LocatorOptions).path[j],\n                nodir: true,\n                ignore: options.ignore,\n            });\n\n            const element = files.shift();\n            if (element) {\n                return pathToLocatorInfo(element, true);\n            }\n        }\n    }\n\n    return undefined;\n}\n","/*\n * Copyright (c) 2022.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nimport { BaseError } from 'ebec';\nimport path from 'node:path';\nimport type { LocatorInfo } from '../locator';\nimport { pathToLocatorInfo } from '../locator';\nimport { hasOwnProperty } from '../utils';\nimport type { LoaderFilterFn, ScriptFileExportItem } from './built-in';\n\nexport function buildLoaderFilePath(input: LocatorInfo | string, withExtension?: boolean) {\n    let info: LocatorInfo;\n\n    if (typeof input === 'string') {\n        info = pathToLocatorInfo(input);\n    } else {\n        info = input;\n    }\n\n    if (\n        withExtension &&\n        info.extension\n    ) {\n        return path.join(info.path, info.name) + info.extension;\n    }\n\n    return path.join(info.path, info.name);\n}\n\nexport function getExportItem(\n    data: Record<string, any>,\n    filterFn?: LoaderFilterFn,\n): ScriptFileExportItem {\n    if (filterFn) {\n        const keys = Object.keys(data);\n        for (let i = 0; i < keys.length; i++) {\n            if (filterFn(keys[i] as string, data[keys[i] as string])) {\n                return {\n                    key: keys[i] as string,\n                    value: data[keys[i] as string],\n                };\n            }\n        }\n\n        throw new BaseError('Cannot find specific module export.');\n    }\n\n    return {\n        key: 'default',\n        value: hasOwnProperty(data, 'default') ? data.default : data,\n    };\n}\n","/*\n * Copyright (c) 2022.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nexport function isJestRuntimeEnvironment() : boolean {\n    return process.env &&\n        process.env.JEST_WORKER_ID !== undefined;\n}\n\nexport function isTsNodeRuntimeEnvironment() : boolean {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    return !!process[Symbol.for('ts-node.register.instance')];\n}\n","/*\n * Copyright (c) 2023.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nimport { BaseError } from 'ebec';\nimport type { JITI } from 'jiti';\nimport createJITI from 'jiti';\nimport { pathToFileURL } from 'node:url';\nimport type { LocatorInfo } from '../../../locator';\nimport { pathToLocatorInfo } from '../../../locator';\nimport { handleFileLoadError, hasStringProperty, isObject } from '../../../utils';\nimport type { Loader } from '../../type';\nimport { buildLoaderFilePath } from '../../utils';\nimport type { ScriptFileLoadOptions } from './type';\nimport { isJestRuntimeEnvironment, isTsNodeRuntimeEnvironment } from './utils';\n\nexport class ModuleLoader implements Loader {\n    protected jiti : JITI;\n\n    constructor() {\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        this.jiti = createJITI(undefined, {\n            extensions: ['.js', '.mjs', '.mts', '.cjs', '.cts', '.ts'],\n        });\n    }\n\n    async execute(input: string) {\n        let output : any;\n\n        try {\n            output = await this.load(input);\n        } catch (e) {\n            // jiti + ts-node\n            // issue: https://github.com/nuxt/bridge/issues/228\n            if (isTsNodeRuntimeEnvironment()) {\n                output = this.loadSync(input);\n            } else {\n                output = this.jiti(input);\n            }\n        }\n\n        return output;\n    }\n\n    executeSync(input: string) {\n        let output : any;\n\n        try {\n            output = this.loadSync(input);\n        } catch (e) {\n            output = this.jiti(input);\n        }\n\n        return output;\n    }\n\n    // ---------------------------------------------------------------------------\n\n    async load(\n        data: LocatorInfo | string,\n        options?: ScriptFileLoadOptions,\n    ) : Promise<unknown> {\n        let locatorInfo : LocatorInfo;\n\n        if (typeof data === 'string') {\n            locatorInfo = pathToLocatorInfo(data);\n        } else {\n            locatorInfo = data;\n        }\n\n        options = options || {};\n\n        let filePath = buildLoaderFilePath(locatorInfo, options.withExtension);\n        if (options.withFilePrefix) {\n            filePath = pathToFileURL(filePath).href;\n        }\n\n        try {\n            // segmentation fault\n            // issue: https://github.com/nodejs/node/issues/35889\n            if (isJestRuntimeEnvironment()) {\n                // eslint-disable-next-line global-require,import/no-dynamic-require\n                return require(filePath);\n            }\n\n            return await import(filePath);\n        } catch (e) {\n            /* istanbul ignore next */\n            if (\n                isObject(e) &&\n                hasStringProperty(e, 'code')\n            ) {\n                if (\n                    !options.withExtension &&\n                    (\n                        e.code === 'ERR_MODULE_NOT_FOUND' ||\n                        e.code === 'MODULE_NOT_FOUND'\n                    )\n                ) {\n                    return this.load(locatorInfo, {\n                        ...options,\n                        withExtension: true,\n                    });\n                }\n\n                if (\n                    !options.withFilePrefix &&\n                    (\n                        e.code === 'ERR_UNSUPPORTED_ESM_URL_SCHEME' ||\n                        e.code === 'UNSUPPORTED_ESM_URL_SCHEME'\n                    )\n                ) {\n                    return this.load(locatorInfo, {\n                        ...options,\n                        withFilePrefix: true,\n                    });\n                }\n\n                throw new BaseError({\n                    code: e.code,\n                    message: hasStringProperty(e, 'message') ? e.message : undefined,\n                    stack: hasStringProperty(e, 'stack') ? e.stack : undefined,\n                });\n            }\n\n            /* istanbul ignore next */\n            return handleFileLoadError(e);\n        }\n    }\n\n    loadSync(\n        data: LocatorInfo | string,\n        options?: ScriptFileLoadOptions,\n    ) : unknown {\n        let locatorInfo : LocatorInfo;\n\n        if (typeof data === 'string') {\n            locatorInfo = pathToLocatorInfo(data);\n        } else {\n            locatorInfo = data;\n        }\n\n        options = options || {};\n\n        const filePath = buildLoaderFilePath(locatorInfo, options.withExtension);\n\n        try {\n            // eslint-disable-next-line global-require,import/no-dynamic-require\n            return require(filePath);\n        } catch (e) {\n            /* istanbul ignore next */\n            if (\n                isObject(e) &&\n                hasStringProperty(e, 'code')\n            ) {\n                if (\n                    !options.withExtension &&\n                    (\n                        e.code === 'ERR_MODULE_NOT_FOUND' ||\n                        e.code === 'MODULE_NOT_FOUND'\n                    )\n                ) {\n                    return this.loadSync(locatorInfo, {\n                        ...options,\n                        withExtension: true,\n                    });\n                }\n\n                throw new BaseError({\n                    code: e.code,\n                    message: hasStringProperty(e, 'message') ? e.message : undefined,\n                    stack: hasStringProperty(e, 'stack') ? e.stack : undefined,\n                });\n            }\n\n            return handleFileLoadError(e);\n        }\n    }\n}\n","/*\n * Copyright (c) 2022-2023.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nimport fs from 'node:fs';\nimport { handleFileLoadError } from '../../../utils';\nimport type { Loader } from '../../type';\nimport { buildLoaderFilePath } from '../../utils';\n\nexport class JSONLoader implements Loader {\n    async execute(input: string) {\n        const filePath = buildLoaderFilePath(input, true);\n\n        try {\n            const file = await fs.promises.readFile(filePath);\n            return JSON.parse(file.toString('utf-8'));\n        } catch (e) {\n            return handleFileLoadError(e);\n        }\n    }\n\n    executeSync(input: string) {\n        const filePath = buildLoaderFilePath(input, true);\n\n        try {\n            const file = fs.readFileSync(filePath);\n            return JSON.parse(file.toString('utf-8'));\n        } catch (e) {\n            return handleFileLoadError(e);\n        }\n    }\n}\n","/*\n * Copyright (c) 2023.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nexport enum LoaderId {\n    MODULE = 'module',\n    JSON = 'json',\n}\n","/*\n * Copyright (c) 2023.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nimport path from 'node:path';\nimport { isFilePath, pathToLocatorInfo } from '../locator';\nimport { JSONLoader, ModuleLoader } from './built-in';\nimport { LoaderId } from './constants';\nimport type { Loader, Rule } from './type';\nimport { buildLoaderFilePath } from './utils';\n\nexport class LoaderManager implements Loader {\n    protected loaders : Record<string, Loader>;\n\n    protected rules : Rule[];\n\n    constructor() {\n        this.loaders = {};\n        this.rules = [\n            {\n                test: ['.js', '.mjs', '.mts', '.cjs', '.cts', '.ts'],\n                loader: LoaderId.MODULE,\n            },\n            {\n                test: ['.json'], loader: LoaderId.JSON,\n            },\n        ];\n    }\n\n    register(rule: Rule) : void;\n\n    register(test: string[] | RegExp, loader: Loader) : void;\n\n    register(test: any, loader?: Loader) : void {\n        if (typeof loader !== 'undefined') {\n            this.rules.push({ test, loader });\n            return;\n        }\n\n        this.rules.push(test);\n    }\n\n    async execute(input: string) : Promise<any> {\n        const id = this.findLoader(input);\n        if (!id) {\n            const info = pathToLocatorInfo(input);\n            throw new Error(`No loader registered for extension: \"${info.extension}\"`);\n        }\n\n        const loader = this.resolve(id);\n        return loader.execute(input);\n    }\n\n    executeSync(input: string) : any {\n        const id = this.findLoader(input);\n        if (!id) {\n            const info = pathToLocatorInfo(input);\n            throw new Error(`No loader registered for extension: ${info.extension || 'unknown'}`);\n        }\n\n        const loader = this.resolve(id);\n        return loader.executeSync(input);\n    }\n\n    findLoader(input: string) : Loader | string | undefined {\n        if (!isFilePath(input)) {\n            return LoaderId.MODULE;\n        }\n\n        const info = pathToLocatorInfo(input);\n        for (let i = 0; i < this.rules.length; i++) {\n            const { test } = this.rules[i] as Rule;\n            if (Array.isArray(test)) {\n                if (test.indexOf(info.extension) !== -1) {\n                    return this.rules[i].loader;\n                }\n            } else if (test.test(buildLoaderFilePath(info))) {\n                return this.rules[i].loader;\n            }\n        }\n\n        return undefined;\n    }\n\n    /**\n     * Resolve loader by id.\n     *\n     * @param id\n     */\n    resolve(id: string | Loader) : Loader {\n        if (typeof id !== 'string') {\n            return id;\n        }\n\n        if (Object.prototype.hasOwnProperty.call(this.loaders, id)) {\n            return this.loaders[id] as Loader;\n        }\n\n        let loader : Loader | undefined;\n\n        // built-in\n        switch (id) {\n            case LoaderId.MODULE: {\n                loader = new ModuleLoader();\n                break;\n            }\n            case LoaderId.JSON: {\n                loader = new JSONLoader();\n                break;\n            }\n            /* istanbul ignore next */\n            default: {\n                const pluginPath = this.normalizePath(id);\n                const moduleLoader = this.resolve(LoaderId.MODULE);\n                loader = moduleLoader.executeSync(pluginPath);\n\n                break;\n            }\n        }\n\n        if (typeof loader !== 'undefined') {\n            this.loaders[id] = loader;\n\n            return loader;\n        }\n\n        throw new Error(`The loader ${id} could not be resolved.`);\n    }\n\n    /* istanbul ignore next */\n    normalizePath(input: string) {\n        if (path.isAbsolute(input) || input.startsWith('./')) {\n            return input;\n        }\n\n        if (input.startsWith('module:')) {\n            return input.substring(0, 'module:'.length);\n        }\n\n        if (!input.startsWith('@')) {\n            return `@locter/${input}`;\n        }\n\n        return input;\n    }\n}\n","/*\n * Copyright (c) 2023.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nimport { LoaderManager } from './module';\n\nlet instance : LoaderManager;\nexport function useLoader() {\n    if (typeof instance !== 'undefined') {\n        return instance;\n    }\n\n    instance = new LoaderManager();\n\n    return instance;\n}\n","/*\n * Copyright (c) 2022.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nimport type { LocatorInfo } from '../locator';\nimport { useLoader } from './singleton';\nimport type { Loader, Rule } from './type';\nimport { buildLoaderFilePath } from './utils';\n\nexport function registerLoader(rule: Rule) : void;\nexport function registerLoader(test: string[] | RegExp, loader: Loader) : void;\nexport function registerLoader(test: any, loader?: Loader) : void {\n    const manager = useLoader();\n    if (typeof loader !== 'undefined') {\n        manager.register(test, loader);\n\n        return;\n    }\n\n    manager.register(test);\n}\n\nexport async function load(input: LocatorInfo | string) : Promise<any> {\n    const manager = useLoader();\n    if (typeof input === 'string') {\n        return manager.execute(input);\n    }\n\n    return manager.execute(buildLoaderFilePath(input, true));\n}\n\nexport function loadSync(input: LocatorInfo | string) : any {\n    const manager = useLoader();\n    if (typeof input === 'string') {\n        return manager.executeSync(input);\n    }\n\n    return manager.executeSync(buildLoaderFilePath(input, true));\n}\n"],"names":["handleFileLoadError","e","Error","removeFileNameExtension","input","extensions","includes","position","lastIndexOf","extension","substring","length","indexOf","hasOwnProperty","obj","prop","Object","prototype","call","hasStringProperty","isObject","item","Array","isArray","toArray","options","buildLocatorOptions","path","push","process","cwd","ignore","isFilePath","info","parse","ext","pathToLocatorInfo","skipResolve","isAbsolute","resolve","dir","split","join","sep","name","globAsync","promisify","glob","locateMany","pattern","patterns","items","i","j","files","absolute","nodir","k","locate","element","shift","undefined","locateManySync","sync","locateSync","buildLoaderFilePath","withExtension","getExportItem","data","filterFn","keys","key","value","BaseError","default","isJestRuntimeEnvironment","env","JEST_WORKER_ID","isTsNodeRuntimeEnvironment","Symbol","for","ModuleLoader","execute","output","load","loadSync","jiti","executeSync","locatorInfo","filePath","withFilePrefix","pathToFileURL","href","require","code","message","stack","constructor","createJITI","JSONLoader","file","fs","promises","readFile","JSON","toString","readFileSync","LoaderId","MODULE","LoaderManager","register","test","loader","rules","id","findLoader","loaders","pluginPath","normalizePath","moduleLoader","startsWith","instance","useLoader","registerLoader","manager"],"mappings":"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"}